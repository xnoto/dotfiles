#!/bin/bash
# chezmoi modify script â€” merges mcpServers into ~/.claude.json
# without clobbering other keys (projects, preferences, etc.)

CURRENT=$(cat)
[ -z "$CURRENT" ] && CURRENT='{}'

MCP_SERVERS='{
  "mcpServers": {
    "linear": {
      "command": "bunx",
      "args": ["mcp-remote", "https://mcp.linear.app/sse"],
      "type": "stdio"
    },
    "notion": {
      "command": "bunx",
      "args": ["mcp-remote", "https://mcp.notion.com/sse"],
      "type": "stdio"
    },
    "aws-api-staging": {
      "command": "uvx",
      "args": ["awslabs.aws-api-mcp-server@latest"],
      "type": "stdio",
      "env": {
        "READ_OPERATIONS_ONLY": "true",
        "AWS_REGION": "us-east-2",
        "AWS_API_MCP_PROFILE_NAME": "staging"
      }
    },
    "aws-doc": {
      "command": "uvx",
      "args": ["awslabs.aws-documentation-mcp-server@latest"],
      "type": "stdio",
      "env": {
        "FASTMCP_LOG_LEVEL": "ERROR",
        "AWS_DOCUMENTATION_PARTITION": "aws"
      }
    },
    "github": {
      "url": "https://api.githubcopilot.com/mcp/",
      "type": "http",
      "headers": {
        "Authorization": "Bearer ${GITHUB_TOKEN}"
      }
    },
    "grafana": {
      "command": "podman",
      "args": [
        "run", "--rm", "-i",
        "-e", "GRAFANA_URL=https://hatchengineering.grafana.net",
        "-e", "GRAFANA_SERVICE_ACCOUNT_TOKEN",
        "docker.io/mcp/grafana:latest",
        "-t", "stdio"
      ],
      "type": "stdio",
      "env": {
        "GRAFANA_SERVICE_ACCOUNT_TOKEN": "${GRAFANA_TOKEN}"
      }
    },
    "agent-hub": {
      "command": "npx",
      "args": ["-y", "agent-hub-mcp@latest"],
      "type": "stdio"
    },
    "tmux": {
      "command": "npx",
      "args": ["-y", "tmux-mcp"],
      "type": "stdio"
    },
    "terraform": {
      "command": "podman",
      "args": ["run", "--rm", "-i", "docker.io/hashicorp/terraform-mcp-server:latest"],
      "type": "stdio"
    },
    "opentofu": {
      "command": "npx",
      "args": ["-y", "@opentofu/opentofu-mcp-server"],
      "type": "stdio"
    },
    "kubernetes": {
      "command": "npx",
      "args": ["-y", "mcp-server-kubernetes"],
      "type": "stdio"
    },
    "aws-api-prod": {
      "command": "uvx",
      "args": ["awslabs.aws-api-mcp-server@latest"],
      "type": "stdio",
      "env": {
        "READ_OPERATIONS_ONLY": "true",
        "AWS_REGION": "us-east-2",
        "AWS_API_MCP_PROFILE_NAME": "prod"
      }
    }
  }
}'

echo "$CURRENT" | jq --argjson mcp "$MCP_SERVERS" '. * $mcp'
